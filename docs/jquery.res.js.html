<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>jquery.res.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="$.res.html">res</a></li><li><a href="$.res-Query.html">Query</a><ul class='methods'><li data-type='method'><a href="$.res-Query.html#addControllercontext">addControllercontext</a></li><li data-type='method'><a href="$.res-Query.html#addProp">addProp</a></li><li data-type='method'><a href="$.res-Query.html#addUsercontext">addUsercontext</a></li><li data-type='method'><a href="$.res-Query.html#toXML">toXML</a></li></ul></li><li><a href="$.res-Ref.html">Ref</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">jquery.res.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* global jQuery, console */

(function($) {
  'use strict';

  /**
   * Initiate a connection to a resource server
   * @param  {string} url     The server's URL. https recommended.
   * @param  {object} options The connection's options
   * @return {TODO} TODOblabla
   * @constructor
   */
  $.res = function(url, options) {

    // Make sure the url ends with a /
    url = /\/$/.exec(url) ? url : url + '/';

    // Defaults to be used, if no options are given
    var defaults = {
      password: null,
      username: null
    };

    // Merge the options with the defaults
    var settings = $.extend({}, defaults, options);

    /**
    * Describes a query that can be sent to a resserver
    *
    * @param {object} options Options, contains start and/or count of a query
    * (optional)
    * ```javascript
    * { start: null, count: null }
    * ```
    *
    * @constructor
    */
    function Query(options) {
      this.start = options.start || null;
      this.count = options.count || null;
      this.usercontext = [];
      this.controllercontext = [];
      this.props = [];
    }

    /**
     * Add a user preference
     *
     * @param {string} name  Property name as full URL or without namespace
     * @param {string} value Desired value for the property
     */
    Query.prototype.addUsercontext = function(name, value) {
      this.usercontext.push({
        name: name,
        value: value
      });
      return this;
    };

    /**
     * Add a controller preference
     *
     * @param {string} name  Property name as full URL or without namespace
     * @param {string} value Desired value for the property
     */
    Query.prototype.addControllercontext = function(name, value) {
      this.controllercontext.push({
        name: name,
        value: value
      });
      return this;
    };

    /**
     * Add a query property describing the desired resource
     * @param {string} name  Property name as full URL or without namespace
     * @param {string} value Desired value for the property
     * @param {object} descs Descriptors describing this property (optional)
     * ```javascript
     * [
     *   { name: "desc1", value: "dvalue1" },
     *   { name: "desc2", value: "dvalue2" }
     * ]
     * ```
     */
    Query.prototype.addProp = function(name, value, descs) {
      this.props.push({
        name: name,
        value: value,
        descs: descs || []
      });
      return this;
    };

    /**
     * Create a XML-Document representing this query
     * @return {TODO} The XML-Document
     */
    Query.prototype.toXML = function() {
      var $query = $('&lt;query>&lt;/query>');

      if (this.start !== null) {
        $query.attr('start', this.start);
      }

      if (this.count !== null) {
        $query.attr('count', this.count);
      }

      if (this.usercontext.length > 0) {
        var $ctx = $('&lt;usercontext>&lt;/usercontext>');
        for (var i = this.usercontext.length - 1; i >= 0; i--) {
          var $prop = $('&lt;prop>')
            .attr('name', this.usercontext[i].name)
            .attr('value', this.usercontext[i].value);
          $ctx.append($prop);
        }
        $query.append($ctx);
      }

      if (this.controllercontext.length > 0) {
        var $ctx = $('&lt;controllercontext>&lt;/controllercontext>');
        for (var i = this.controllercontext.length - 1; i >= 0; i--) {
          var $prop = $('&lt;prop>')
            .attr('name', this.controllercontext[i].name)
            .attr('value', this.controllercontext[i].value);
          $ctx.append($prop);
        }
        $query.append($ctx);
      }

      if (this.props.length > 0) {
        for (var i = this.props.length - 1; i >= 0; i--) {
          var $prop = $('&lt;prop>')
            .attr('name', this.props[i].name)
            .attr('value', this.props[i].value);
          for (var i = this.props[i].descs.length - 1; i >= 0; i--) {
            var $desc = $('&lt;descriptor>')
              .attr('name', this.props[i].descs[i].name)
              .attr('value', this.props[i].descs[i].value);
            $prop.append($desc);
          }
          $query.append($prop);
        }
      }

      return $query;
    };

    /**
     * A Query that is a reference to an earlier query
     * @param {string} ref Query reference identifier that had been assigned by
     * the server in a previous response
     *
     * @constructor
     */
    function Ref(ref) {
      this.ref = ref;
    }

    return {
      query: function(params) {
        var $deferred = $.Deferred();
        console.log(params);

        $.ajax({
          url: url + 'query',
          contentType: 'text/xml', // datatype of data sent
          crossDomain: true, // tell jQuery CORS is ok
          data: params, // send plain xml data
          dataType: 'xml', // expected datatype of the response
          /*
           * Since GET is 'a simplified request type' and would not support:
           * - specifing a property descriptor,
           * - specifing the first index or
           * - specifing the number of returned elements in the resource list,
           * this library supports only POST requests.
           */
          method: 'POST',
          password: settings.password,
          processData: false, // dont convert the xml data sent
          username: settings.username
        }).done(function(data){
          $deferred.resolve($(data));
        }).fail(function(xhr, status, error){
          $deferred.reject(xhr, status, error);
        });

        return $deferred;
      }
    };
  };

}(jQuery));
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0</a> on Thu May 28 2015 00:25:12 GMT+0200 (Mitteleurop√§ische Sommerzeit) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
