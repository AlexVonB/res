!function(t){"use strict";t.res=function(e,r){function n(){this.queries=[]}function o(t,e){this._parent=e||null,this.start=t.start||null,this.count=t.count||null,this.usercontext=[],this.controllercontext=[],this.props=[]}function s(t){this.ref=t}e=/\/$/.exec(e)?e:e+"/";var a={password:null,username:null},i=t.extend({},a,r);return n.prototype.addQuery=function(t){var e=new o(t,this);return this.queries.push(e),e},n.prototype.addRef=function(t){return this.queries.push(new s(t)),this},n.prototype.toXMLString=function(){for(var e=t("<queries>"),r=0;r<this.queries.length;r++)e.append(this.queries[r].toXML());var n=(new XMLSerializer).serializeToString(e[0]);return n.replace(' xmlns="http://www.w3.org/1999/xhtml"',"")},n.prototype.send=function(){var r=t.Deferred(),n=this.toXMLString();return console.log(n),t.ajax({url:e+"query",contentType:"text/xml",crossDomain:!0,data:n,dataType:"xml",method:"POST",password:i.password,processData:!1,username:i.username}).done(function(e){r.resolve(t(e))}).fail(function(t,e,n){r.reject(t,e,n)}),r},o.prototype.complete=function(){return this._parent},o.prototype.addUsercontext=function(t,e){return this.usercontext.push({name:t,value:e}),this},o.prototype.addControllercontext=function(t,e){return this.controllercontext.push({name:t,value:e}),this},o.prototype.addProp=function(t,e,r){return this.props.push({name:t,value:e,descs:r||[]}),this},o.prototype.toXML=function(){var e=t("<query></query>");if(null!==this.start&&e.attr("start",this.start),null!==this.count&&e.attr("count",this.count),this.usercontext.length>0){for(var r=t("<usercontext></usercontext>"),n=0;n<this.usercontext.length;n++){var o=t("<prop>").attr("name",this.usercontext[n].name).attr("val",this.usercontext[n].value);r.append(o)}e.append(r)}if(this.controllercontext.length>0){for(var r=t("<controllercontext></controllercontext>"),n=0;n<this.controllercontext.length;n++){var o=t("<prop>").attr("name",this.controllercontext[n].name).attr("val",this.controllercontext[n].value);r.append(o)}e.append(r)}if(this.props.length>0)for(var n=0;n<this.props.length;n++){for(var o=t("<prop>").attr("name",this.props[n].name).attr("val",this.props[n].value),s=0;s<this.props[n].descs.length;s++){var a=t("<descriptor>").attr("name",this.props[n].descs[s].name).attr("val",this.props[n].descs[s].value);o.append(a)}e.append(o)}return e},s.prototype.toXML=function(){return t("<query>").attr("ref",this.ref)},{queries:function(){return new n}}}}(jQuery);