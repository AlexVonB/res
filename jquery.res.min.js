!function(t){"use strict";t.res=function(e,r){function n(){this.queries=[]}function o(t){this._parent=t||null,this.start=null,this.count=null,this.usercontext=[],this.controllercontext=[],this.props=[]}function s(t,e,r,n){this._parent=t||null,this.name=e||null,this.value=r||null,this.descs=n||[]}function i(t){this.ref=t}e=/\/$/.exec(e)?e:e+"/";var u={password:null,username:null},a=t.extend({},u,r);return n.prototype.addQuery=function(){var t=new o(this);return this.queries.push(t),t},n.prototype.addRef=function(t){return this.queries.push(new i(t)),this},n.prototype.toXMLString=function(){for(var e=t("<queries>"),r=0;r<this.queries.length;r++)e.append(this.queries[r].toXML());var n=(new XMLSerializer).serializeToString(e[0]);return n.replace(' xmlns="http://www.w3.org/1999/xhtml"',"")},n.prototype.send=function(){var r=t.Deferred(),n=this.toXMLString();return console.log(n),t.ajax({url:e+"query",contentType:"text/xml",crossDomain:!0,data:n,dataType:"xml",method:"POST",password:a.password,processData:!1,username:a.username}).done(function(e){r.resolve(t(e))}).fail(function(t,e,n){r.reject(t,e,n)}),r},o.prototype.complete=function(){return this._parent},o.prototype.setStart=function(t){return this.start=t,this},o.prototype.setCount=function(t){return this.count=t,this},o.prototype.addUsercontext=function(t,e){return this.usercontext.push({name:t,value:e}),this},o.prototype.addControllercontext=function(t,e){return this.controllercontext.push({name:t,value:e}),this},o.prototype.addProp=function(t,e,r){return this.props.push(new s(this,t,e,r)),this},o.prototype.addPropWithDescs=function(t,e){var r=new s(this,t,e);return this.props.push(r),r},o.prototype.toXML=function(){var e=t("<query></query>");if(null!==this.start&&e.attr("start",this.start),null!==this.count&&e.attr("count",this.count),this.usercontext.length>0){for(var r=t("<usercontext></usercontext>"),n=0;n<this.usercontext.length;n++){var o=t("<prop>").attr("name",this.usercontext[n].name).attr("val",this.usercontext[n].value);r.append(o)}e.append(r)}if(this.controllercontext.length>0){for(var r=t("<controllercontext></controllercontext>"),n=0;n<this.controllercontext.length;n++){var o=t("<prop>").attr("name",this.controllercontext[n].name).attr("val",this.controllercontext[n].value);r.append(o)}e.append(r)}for(var n=0;n<this.props.length;n++)e.append(this.props[n].toXML());return e},s.prototype.complete=function(){return this._parent},s.prototype.addDesc=function(t,e){return this.descs.push({name:t,value:e}),this},s.prototype.toXML=function(){for(var e=t("<prop>").attr("name",this.name).attr("val",this.value),r=0;r<this.descs.length;r++){var n=t("<descriptor>").attr("name",this.descs[r].name).attr("val",this.descs[r].value);e.append(n)}return e},i.prototype.toXML=function(){return t("<query>").attr("ref",this.ref)},{queries:function(){return new n}}}}(jQuery);