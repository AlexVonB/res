!function(t){"use strict";t.res=function(e,r){function n(){this.queries=[]}function s(t){this._parent=t||null,this.start=null,this.count=null,this.usercontext=[],this.controllercontext=[],this.props=[]}function o(t,e,r,n){this._parent=t||null,this.name=e||null,this.value=r||null,this.descs=n||[]}function i(t,e,r){this.ref=t,this.start=e||void 0,this.count=r||void 0}function u(e){this._nextIndex=0,this.responses=[];var r=this;e.find("response").each(function(e,n){r.responses.push(new a(t(n)))})}function a(e){this._nextIndex=0,this.ref=e.attr("ref")||null,this.expired="true"===e.attr("expired"),this.start=void 0===e.attr("start")?null:parseInt(e.attr("start")),this.count=void 0===e.attr("count")?null:parseInt(e.attr("count")),this.total=void 0===e.attr("total")?null:parseInt(e.attr("count")),this.resources=[];var r=this;e.find("resource").each(function(e,n){r.resources.push(new p(t(n)))})}function p(e){this.about=e.attr("about"),this.globalAts=[],this.props=[];var r=this;e.find("globalAt").each(function(e,n){r.globalAts.push(t(n).text())}),e.find("prop").each(function(e,n){var s=new o(null,t(n).attr("name"),t(n).attr("val"));t(n).find("descriptor").each(function(e,r){s.addDesc(t(r).attr("name"),t(r).attr("val"))}),r.props.push(s)})}e=/\/$/.exec(e)?e:e+"/";var h={password:null,username:null},c=t.extend({},h,r);return n.prototype.addQuery=function(){var t=new s(this);return this.queries.push(t),t},n.prototype.addRef=function(t,e,r){return this.queries.push(new i(t,e,r)),this},n.prototype.toXMLString=function(){for(var e=t("<queries>"),r=0;r<this.queries.length;r++)e.append(this.queries[r].toXML());var n=(new XMLSerializer).serializeToString(e[0]);return n.replace(' xmlns="http://www.w3.org/1999/xhtml"',"")},n.prototype.send=function(){var r=t.Deferred(),n=this.toXMLString();return console.log(n),t.ajax({url:e+"query",contentType:"text/xml",crossDomain:!0,data:n,dataType:"xml",method:"POST",password:c.password,processData:!1,username:c.username}).done(function(e){r.resolve(new u(t(e)))}).fail(function(t,e,n){r.reject(t,e,n)}),r.promise()},s.prototype.complete=function(){return this._parent},s.prototype.setStart=function(t){return this.start=t,this},s.prototype.setCount=function(t){return this.count=t,this},s.prototype.addUsercontext=function(t,e){return this.usercontext.push({name:t,value:e}),this},s.prototype.addControllercontext=function(t,e){return this.controllercontext.push({name:t,value:e}),this},s.prototype.addProp=function(t,e,r){return this.props.push(new o(this,t,e,r)),this},s.prototype.addPropWithDescs=function(t,e){var r=new o(this,t,e);return this.props.push(r),r},s.prototype.toXML=function(){var e=t("<query></query>");if(null!==this.start&&e.attr("start",this.start),null!==this.count&&e.attr("count",this.count),this.usercontext.length>0){for(var r=t("<usercontext></usercontext>"),n=0;n<this.usercontext.length;n++){var s=t("<prop>").attr("name",this.usercontext[n].name).attr("val",this.usercontext[n].value);r.append(s)}e.append(r)}if(this.controllercontext.length>0){for(var o=t("<controllercontext></controllercontext>"),i=0;i<this.controllercontext.length;i++)o.append(t("<prop>").attr("name",this.controllercontext[i].name).attr("val",this.controllercontext[i].value));e.append(o)}for(var u=0;u<this.props.length;u++)e.append(this.props[u].toXML());return e},o.prototype.complete=function(){return this._parent},o.prototype.addDesc=function(t,e){return this.descs.push({name:t,value:e}),this},o.prototype.toXML=function(){for(var e=t("<prop>").attr("name",this.name).attr("val",this.value),r=0;r<this.descs.length;r++){var n=t("<descriptor>").attr("name",this.descs[r].name).attr("val",this.descs[r].value);e.append(n)}return e},i.prototype.toXML=function(){return t("<query>").attr("ref",this.ref).attr("start",this.start).attr("count",this.count)},u.prototype.numberOfResponses=function(){return this.responses.length},u.prototype.firstResponse=function(){return this.responses[0]},u.prototype.hasNextResponse=function(){return this._nextIndex<this.responses.length},u.prototype.nextResponse=function(){return this.responses[this._nextIndex++]},u.prototype.resetResponse=function(){return this._nextIndex=0,this},u.prototype.getVeryFirstGlobalAt=function(){return this.firstResponse().firstResource().getFirstGlobalAt()},a.prototype.hasRef=function(){return null!==this.ref},a.prototype.hasMoreOnServer=function(){return void 0},a.prototype.numberOfResources=function(){return this.resources.length},a.prototype.firstResource=function(){return this.resources[0]},a.prototype.hasNextResource=function(){return this._nextIndex<this.resources.length},a.prototype.nextResource=function(){return this.resources[this._nextIndex++]},a.prototype.resetResource=function(){return this._nextIndex=0,this},p.prototype.getFirstGlobalAt=function(){return this.globalAts.length>0?this.globalAts[0]:null},{queries:function(){return new n}}}}(jQuery);